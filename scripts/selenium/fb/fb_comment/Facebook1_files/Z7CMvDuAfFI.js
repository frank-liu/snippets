/*1364823864,173213983*/

if (self.CavalryLogger) { CavalryLogger.start_js(["4hKYA"]); }

__d("WindowComm",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={_callbacks:{},makeHandler:function(i,j){j=j||'opener';var k='f'+(Math.random()*(1<<30)).toString(16).replace('.','');h._callbacks[k]=i;return new g('/connect/window_comm.php').setQueryData({_id:k,_relation:j}).getQualifiedURI().toString();},_recv:function(i){var j=new g(i).getQueryData();h._callbacks[j._id](j);}};e.exports=h;a.WindowComm=h;});
__d("OpenIDRequest",["AsyncRequest","AsyncSignal","URI","UserAgent","coalesce","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AsyncSignal'),i=b('URI'),j=b('UserAgent'),k=b('coalesce'),l=b('copyProperties'),m=b('createArrayFrom');function n(){var o=new g().setReadOnly(true).setHandler(this.asyncResponseHandler.bind(this)).setErrorHandler(this.asyncErrorHandler.bind(this));l(this,{openidUrl:null,requestId:n.maxRequestId++,successResponseHandler:null,cancelHandler:null,intermediateHandler:null,immediateMode:false,useExtensions:true,thirdPartyLogin:false,popupWindow:null,asyncRequest:o,retryCount:0});n.requests[this.requestId]=this;}n.getRequestById=function(o){return n.requests[o];};n.prototype.setOpenIDUrl=function(o){this.openidUrl=o;return this;};n.prototype.setSuccessHandler=function(o){this.successResponseHandler=o;return this;};n.prototype.setErrorHandler=function(o){this.errorHandler=o;return this;};n.prototype.setCancelHandler=function(o){this.cancelHandler=o;return this;};n.prototype.setImmediateMode=function(o){this.immediateMode=o;return this;};n.prototype.setUseExtensions=function(o){this.useExtensions=o;return this;};n.prototype.setIntermediateHandler=function(o){this.intermediateHandler=o;return this;};n.prototype.setThirdPartyLogin=function(o){this.thirdPartyLogin=o;return this;};n.prototype.send=function(){if(!this.openidUrl)throw "openidUrl is a required parameter. Call setOpenIDUrl()";var o=this.calculateRedirectUrl();if(!o){this.logMetrics('redirectUrlNotFound');return;}if(this.immediateMode){this.createHiddenIframe(o);}else{if(this.popupWindow)throw "OpenID popup is already in progress";this.showPopup(o);}this.logMetrics('requestSent');};n.prototype.calculateRedirectUrl=function(o){var p=this.immediateMode?'checkid_immediate':'checkid_setup',q={'openid.mode':p},r;if(!n.cache[this.openidUrl])return null;r=n.cache[this.openidUrl].url;var s=i(i(r).getQueryData()['openid.return_to']);s.addQueryData({context:n.context,request_id:this.requestId});q['openid.return_to']=s.toString();q.third_party_login=this.thirdPartyLogin;return i(r).addQueryData(q).getQualifiedURI();};n.prototype.createHiddenIframe=function(o){var p='openid_request_'+this.requestId,q=document.body.appendChild(document.createElement('div')),r=function(){q.innerHTML=('<iframe name="'+p+'"'+' src="'+o.toString()+'"'+' scrolling="no" '+' frameborder="0" class="hidden_elem"></iframe>');};if(j.ie()){q.innerHTML='<iframe src="javascript:false"></iframe>';r.defer();}else r();};n.prototype.showPopup=function(o){var p;if(n.cache[this.openidUrl])p=n.cache[this.openidUrl].popup_dimensions;if(!p||!p.height||!p.width)p={height:'580',width:'790'};var q={x:k(window.screenX,window.screenLeft),y:k(window.screenY,window.screenTop),width:k(window.outerWidth,document.body.clientWidth),height:k(window.outerHeight,document.body.clientHeight)},r=q.x+((q.width-p.width)/2),s=q.y+((q.height-p.height)/2),t=["location=yes","scrollbars=1","left="+r,"top="+s,"resizable=yes","height="+p.height,"width="+p.width].join(",");this.popupWindow=window.open(o.toString(),'_blank',t);this.popupPollInterval=setInterval(this.pollPopupWindow.bind(this),100);this.popupWindow.focus();};n.prototype.pollPopupWindow=function(){if(!(this.popupPollInterval&&this.popupWindow))return;if(this.popupWindow.closed){clearInterval(this.popupPollInterval);this.cancel();}};n.prototype.closePopupIfOpen=function(){if(this.popupWindow){if(this.popupPollInterval)clearInterval(this.popupPollInterval);this.popupWindow.close();}this.popupWindow=null;};n.prototype.cancel=function(){this.closePopupIfOpen();if(this.cancelHandler)this.cancelHandler();this.logMetrics('requestCanceled');};n.prototype.logMetrics=function(o){new h('/ajax/openid/metrics.php',{metric:o,immediate:this.immediateMode,context:n.context,openid_url:this.openidUrl}).send();};n.prototype.triggerCompleteAuthAsync=function(o){if(o.charAt(0)=='?'||o.charAt(0)=='&')o=o.substr(1);var p=i.explodeQuery(o);this.closePopupIfOpen();if(p['openid.mode']=='cancel'){this.cancel();return;}if(this.intermediateHandler)this.intermediateHandler();this.asyncRequest.setData({openid_params:p}).send();};n.prototype.asyncResponseHandler=function(o){var p=o.getPayload();if(this.successResponseHandler)this.successResponseHandler(p);this.closePopupIfOpen();};n.prototype.cleanHandleResponse=function(o){if(o.css)o.css=m(o.css);this.asyncRequest.handleResponse(o);};n.prototype.asyncErrorHandler=function(o){this.closePopupIfOpen();if(o.error==1428010||o.error==1428011){this.cancel();return;}if(this.errorHandler)this.errorHandler(o);};n.prototype.retry=function(){++this.retryCount;this.requestId=n.maxRequestId++;this.send();};n.prototype.setProviderCache=function(o){n.cache=o;return this;};n.cache={};n.requests=[];n.maxRequestId=0;n.context='default';e.exports=n;});
__d("WidgetArbiter",["createArrayFrom"],function(a,b,c,d,e,f){var g=b('createArrayFrom'),h={_findSiblings:function(){if(h._siblings)return;h._siblings=[];for(var i=parent.frames.length-1;i>=0;i--)try{if(parent.frames[i]&&parent.frames[i].Arbiter&&parent.frames[i].Arbiter.inform)h._siblings.push(parent.frames[i].Arbiter);}catch(j){}},inform:function(){h._findSiblings();var i=g(arguments);h._siblings.forEach(function(j){j.inform.apply(j,i);});}};e.exports=h;});
__d("MentionsInputMatchers",[],function(a,b,c,d,e,f){var g=['@','\\uff20','+','\\uff0b'].join(''),h='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',i='\\b[A-Z][^ A-Z'+h+']',j='([^'+g+h+']|['+h+'][^ '+h+'])',k='(?:^|\\s)(?:['+g+']('+j+'{0,20}))',l='(?:(?:'+i+'+)|'+k+')',m='(?:'+i+'{4,})',n={trigger:new RegExp('['+g+']$'),mainMatcher:new RegExp(k+'$'),autoMatcher:new RegExp(l+'$'),userMatcher:new RegExp(m+'$')};e.exports=n;});
__d("MentionsInput",["function-extensions","Arbiter","ArbiterMixin","CSS","DataStore","DOM","Event","HTML","Input","InputSelection","Keys","MentionsInputMatchers","Parent","Style","TypeaheadUtil","UserAgent","copyProperties","htmlize","removeFromArray","repeatString"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Event'),m=b('HTML'),n=b('Input'),o=b('InputSelection'),p=b('Keys'),q=b('MentionsInputMatchers'),r=b('Parent'),s=b('Style'),t=b('TypeaheadUtil'),u=b('UserAgent'),v=b('copyProperties'),w=b('htmlize'),x=b('removeFromArray'),y=b('repeatString'),z='\uFEFF',aa=new RegExp(z,'g'),ba=function(fa){return fa+z;};function ca(fa,ga){return fa.replace(ga,y(' ',ga.length));}function da(fa,ga){return fa.substring(0,ga)+fa.substring(ga+1);}function ea(fa,ga,ha,ia,ja,ka){j.set(fa,'MentionsInput',this);this._root=fa;this._typeahead=ga;this._input=ha;var la=null,ma=this.init.bind(this,ia,ja,ka);try{la=document.activeElement===this._input;}catch(na){}if(la){ma.defer();}else var oa=l.listen(this._input,'focus',function(){ma.defer();oa.remove();});}ea.getInstance=function(fa){var ga=r.byClass(fa,'uiMentionsInput');return ga?j.get(ga,'MentionsInput'):null;};v(ea.prototype,h,{init:function(fa,ga,ha){if(this._initialized)return;this._initialized=true;this._highlighter=k.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=k.find(this._root,'.highlighterContent');this._hiddenInput=k.find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=fa.max||6;this._metrics=ha;if(!this._hiddenInput.name){var ia=this._input.name;this._input.name=ia+'_text';this._hiddenInput.name=ia;}this._initEvents();this._initTypeahead();this.reset(ga);this.inform('init',null,g.BEHAVIOR_STATE);},reset:function(fa){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&k.empty(this._highlighterContent);this._highlighterAuxContent&&k.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;n.setPlaceholder(this._input,this._placeholder);s.set(this._typeahead.getElement(),'height','auto');var ga=fa&&fa.value||'',ha=fa&&fa.mentions;if(ha&&ha.length){var ia=[];ha.forEach(function(ja){ia.push(ja.offset+ja.length);delete ja.offset;delete ja.length;this._addToken(ja);},this);ia.reverse().forEach(function(ja){ga=ga.substring(0,ja)+z+ga.substring(ja);});}n.setValue(this._input,ga);this._updateTypeahead();this._updateWidth();this._update();},getValue:function(){return this._getMarkedValue().replace(aa,'');},_getMarkedValue:function(){return n.getValue(this._input);},getRawValue:function(){this._update();return n.getValue(this._hiddenInput);},checkValue:function(){var fa=this._typeahead.getCore().getValue();if(q.trigger.exec(fa)||fa==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var fa=this._update.bind(this);l.listen(this._input,{input:fa,keyup:fa,change:fa,blur:this._handleBlur.bind(this),focus:this._handleFocus.bind(this),keydown:this._handleKeydown.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);l.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(ka,la){var ma=la.selected;this._addToken({uid:ma.uid,text:ma.text,type:ma.type,weakreference:ma.weak_reference});this.updateValue();}.bind(this));var fa=this._input,ga=null;function ha(){if(ga===null){ga=n.getSubmitOnEnter(fa);n.setSubmitOnEnter(fa,false);}}function ia(){if(ga!==null){n.setSubmitOnEnter(fa,ga);ga=null;}}this._typeahead.subscribe('reset',ia);this._typeahead.subscribe('render',ha);this._typeahead.subscribe('highlight',function(ka,la){la.index>=0?ha():ia();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));var ja=this._typeahead.getCore();ja.suffix=z;this._handleFocus();},_handleBlur:function(){if(this._filterToken){this._filterToken.remove();this._filterToken=null;}},_handleFocus:function(){if(!this._filterToken)this._filterToken=this._typeahead.getData().addFilter(this._filterResults.bind(this));this._updateWidth();},_handleKeydown:function(event){var fa=event.keyCode;if(fa==p.BACKSPACE||fa==p.DELETE)this._handleBackspaceAndDelete(event,fa);if(fa==p.LEFT||fa==p.RIGHT)setTimeout(this._handleLeftAndRight.bind(this,fa),10);},_handleLeftAndRight:function(fa){var ga=this._getMarkedValue(),ha=o.get(this._input),ia=ha.start,ja=ha.end,ka=fa==p.LEFT,la=fa==p.RIGHT;if(ia==ja){var ma=ka?-1:1;if(ga.charAt(ia)==z)o.set(this._input,ia+ma);}else if(ka&&ga.charAt(ia)==z){o.set(this._input,ia-1,ja);}else if(ka&&ga.charAt(ja)==z){o.set(this._input,ia,ja-1);}else if(la&&ga.charAt(ja)==z){o.set(this._input,ia,ja+1);}else if(la&&ga.charAt(ia)==z)o.set(this._input,ia+1,ja);},_handleBackspaceAndDelete:function(event,fa){var ga=o.get(this._input),ha=false;if(ga.start!==ga.end)if(this._offsetIsInsideMention(ga.start+1)&&this._offsetIsInsideMention(ga.end)){ha=(fa===p.BACKSPACE);}else return;var ia=fa===p.DELETE?1:-1,ja=ia+(ha?ga.end:ga.start),ka=this._getMarkedValue(),la=ka;for(var ma=0;ma<this._orderedUIDs.length;++ma){var na=this._mentioned[this._orderedUIDs[ma]],oa=na.text,pa=ba(oa),qa=la.indexOf(pa),ra=qa+pa.length;if(ja<qa||ja>=ra){la=ca(la,pa);continue;}var sa,ta;if(na.type!='user'){sa=0;ta=[oa];}else{sa=pa.substring(0,ja-qa).split(' ').length-1;ta=oa.split(' ');}var ua=ta.splice(sa,1)[0],va=ta.join(' '),wa=sa===0?qa:ra-ua.length-1;if(va){na.text=va;va=ba(va);}else this._removeToken(na.uid);var xa=ka.substring(0,qa)+va+ka.substring(ra);n.setValue(this._input,xa);o.set(this._input,wa);this._update();event.kill();break;}},_offsetIsInsideMention:function(fa){for(var ga=0;ga<this._offsets.length;ga++)if(fa>this._offsets[ga][0]&&fa<=this._offsets[ga][1])return true;return false;},_filterResults:function(fa){if(this._filterData===null){var ga=o.get(this._input).start;if(this._offsetIsInsideMention(ga)){this._filterData={caretIsInsideMention:true};return false;}var ha=this._typeahead.getCore();this._filterData={value:ha.getValue(),rawValue:ha.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(q.mainMatcher.test(this._filterData.rawValue))return true;if(fa.type!='user')return false;if(fa.disable_autosuggest)return false;if(q.userMatcher.test(this._filterData.value))return true;return t.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(fa));},_addToken:function(fa){var ga=fa.uid;if(!this._mentioned.hasOwnProperty(ga)){this._mentioned[ga]=fa;this._orderedUIDs.push(ga);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(fa){if(this._mentioned.hasOwnProperty(fa)){delete this._mentioned[fa];x(this._orderedUIDs,fa);this._numMentioned--;this._updateTypeahead();}},_update:function(){var fa=this._getMarkedValue();if(fa==this._value)return;this._value=fa;this._updateMentions();this._updateDirection();this.updateValue();},_updateMentions:function(){this._offsets=[];var fa=this._getMarkedValue(),ga=fa;for(var ha=0;ha<this._orderedUIDs.length;++ha){var ia=this._orderedUIDs[ha],ja=ba(this._mentioned[ia].text),ka=ga.indexOf(ja);if(ka==-1)this._removeToken(ia);ga=ca(ga,ja);this._offsets.push([ka,ka+ja.length]);}var la=fa;while((ka=ga.indexOf(z))>-1){la=da(la,ka);ga=da(ga,ka);}if(fa!==la){var ma=o.get(this._input);n.setValue(this._input,la);o.set(this._input,ma.start);this._value=la;}},updateValue:function(){var fa=this._getMarkedValue(),ga=this._orderedUIDs,ha,ia,ja,ka,la,ma;for(ha=0;ha<ga.length;++ha){ka=ba(this._mentioned[ga[ha]].text);fa=fa.replace(ka,'@['+ga[ha]+':]');}ma=w(fa);for(ha=0;ha<ga.length;++ha){ia=ga[ha];ja=this._mentioned[ia].text;ka=ba(ja);la=this._mentioned[ia].weakreference?'<b class="weak">':'<b>';ma=ma.replace('@['+ia+':]',la+w(ka)+'</b>');ja=ja.replace(/[\\\]:]/g,function(na){return '\\'+na;});fa=fa.replace('@['+ia+':]','@['+ia+':'+ja+']');}if(u.ie())ma=ma.replace(/ /g,'&nbsp;<wbr/>');k.setContent(this._highlighterContent,m(ma));this._hiddenInput.value=fa;this._updateHighlighter();this._updateHeight();},_updateDirection:function(){var fa=s.get(this._input,'direction');if(fa==this._dir)return;this._dir=fa;s.set(this._highlighter,'direction',fa);if(fa=='rtl'){s.set(this._highlighter,'text-align','right');}else s.set(this._highlighter,'text-align','left');},_updateWidth:function(){var fa=s.getFloat.curry(this._input),ga=this._input.offsetWidth-fa('paddingLeft')-fa('paddingRight')-fa('borderLeftWidth')-fa('borderRightWidth');if(u.firefox())ga-=2;if(u.ie()<=7){ga-=s.getFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(ga,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var fa=this._highlighter.offsetHeight,ga=this._typeahead.getElement();if(fa>ga.offsetHeight){s.set(ga,'height',fa+'px');g.inform('reflow');}}},_updateTypeahead:function(){var fa=this._typeahead.getCore(),ga=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)ga=q.autoMatcher;fa.matcher=ga;fa.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},setPlaceholder:function(fa){this._placeholder=fa;if(!this.hasAuxContent())n.setPlaceholder(this._input,fa);},_updateHighlighter:function(){if(this._highlighterContent)i.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent());},setAuxContent:function(fa){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=k.create('span',{className:'highlighterAuxContent'});k.insertAfter(this._highlighterContent,this._highlighterAuxContent);}k.setContent(this._highlighterAuxContent,fa);if(fa){n.setPlaceholder(this._input,'');}else n.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}},hasAuxContent:function(){var fa=this.getAuxContentRoot();return fa&&fa.innerHTML.length>0;},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(fa){var ga=this._getMarkedValue();if(ga!=='')ga+=' ';n.setValue(this._input,ga+ba(fa.text)+' ');this._addToken(fa);this._update();},getMentions:function(){return this._mentioned;}});e.exports=ea;});
__d("PlatformOptInPopup",["PopupWindow","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('PopupWindow'),h=b('URI'),i=b('copyProperties'),j=function(){};i(j,{DIALOG_URL:'/connect/uiserver.php',DIALOG_WIDTH:420,DIALOG_HEIGHT:450,APP_ID:127760087237610,open:function(k,l,m){if(!k)k='generic';if(!l)l='plugin.optin';var n=new h(j.DIALOG_URL);n.addQueryData({social_plugin:k,method:l,display:'popup',secure:h.getRequestURI().isSecure(),app_id:j.APP_ID});if(m)n.addQueryData(m);return g.open(n.toString(),j.DIALOG_WIDTH,j.DIALOG_HEIGHT);}});e.exports=j;});
__d("Feedback",["AsyncRequest","CSS","Dialog","DOM","Event","Input","LegacyContextualDialog","MentionsInput","Parent","PlatformOptInPopup","Style","Vector","$","tx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('Dialog'),j=b('DOM'),k=b('Event'),l=b('Input'),m=b('LegacyContextualDialog'),n=b('MentionsInput'),o=b('Parent'),p=b('PlatformOptInPopup'),q=b('Style'),r=b('Vector'),s=b('$'),t=b('tx'),u={comments:{},registerComment:function(v,w){u.comments[v]=w;return u;},getRegisteredComment:function(v){return u.comments[v];},deleteClickHandler:function(v,w,x,y,z,aa){var ba=new i().setTitle("Delete post?").setBody("Are you sure you want to delete this post?").setButtons([i.newButton('delete',"Delete"),i.CANCEL]).setHandler(function(event){new g().setURI('/ajax/connect/feedback.php').setData({command:'delete',url:v,uniqid:y,owns_pages:z,controller_id:x,locale:aa,comment_id:w}).send();}.bind(this)).show();},resizeCommentas:function(v){var w=j.scry(v,'div.post')[0];if(w){var x=r.getElementDimensions(w).x;if(x){var y=j.find(w,'.commentas'),z=r.getElementDimensions(y).x;if((x-z)<190&&(x-190)>60){q.set(y,'width',x-190+'px');var aa=j.scry(y,'span.commentas_inner')[0];if(aa){var ba=r.getElementDimensions(aa).x;q.set(y,'width',ba+'px');}}}}},exposeContextualDialogReply:function(v){var w=s(v),x=w.parentNode.parentNode;h.show(j.find(x,"form"));j.find(x,"textarea").focus();return false;},concealContextualDialogReply:function(v){var w=s(v),x=w.parentNode.parentNode,y=j.find(x,"form"),z=j.find(x,"textarea"),aa=z.value.length;if(!l.getValue(z))h.hide(y);return false;},closeContextualDialog:function(v){var w=m.getInstance(s(v));w.hide();return false;},_clickLocked:false,attachOptInClickListener:function(v){k.listen(v,'click',function(w){k.kill(w);if(!this._clickLocked){this._clickLocked=true;setTimeout(function(){this._clickLocked=false;}.bind(this),1000);p.open('feedback','plugin.optin');}});},attachReplyListener:function(v){if(!v)return;var w=j.find(v,'textarea');v.suppressBlur=false;k.listen(v,'click',function(x){var y=x.getTarget(),z=o.byClass(y,'commentas')!==null,aa=o.byClass(y,'uiButton')!==null,ba=o.byClass(y,'uiSelector')!==null;v.suppressBlur=z||aa||ba;});k.listen(w,'blur',function(x,y){if(v.interval)return;v.interval=setInterval((function(z,aa){if(z.suppressBlur||l.getValue(aa)||aa==document.activeElement)return;h.hide(z);z.suppressBlur=false;clearInterval(z.interval);delete z.interval;}).curry(v,x),100);}.curry(w));},attachReplyClickListener:function(v,w,x){if(!v)return;var y=j.find(v,'textarea');k.listen(w,'click',function(z){h.show(v);y.focus();if(!x.isViewer&&x.isReply){var aa=n.getInstance(y);if(aa){var ba=aa.getMentions();if(!ba[x.uid]&&l.getValue(y)==='')aa.addMention(x);}else l.setValue(y,x.text+' ');}z.preventDefault();});},resetInput:function(v){var w=n.getInstance(v);if(w){w.reset();}else l.setValue(v,'');}};e.exports=a.Feedback||u;});
__d("CommentAdminPanelController",["Arbiter","AsyncRequest","Button","ChannelConstants","CSS","DOM","Event","Feedback","Parent","Toggler","XD","URI","$","copyProperties","ge","startsWith","MultiLoginPopup"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Button'),j=b('ChannelConstants'),k=b('CSS'),l=b('DOM'),m=b('Event'),n=b('Feedback'),o=b('Parent'),p=b('Toggler'),q=b('XD').UnverifiedXD,r=b('URI'),s=b('$'),t=b('copyProperties'),u=b('ge'),v=b('startsWith'),w=function(x){t(this,{locale:x.locale,channel:x.channel,controllerID:x.controllerID,commentIDs:x.commentIDs,domIDs:x.domIDs,duplicateComments:[],fetchMoreCommentsIsPending:{},blacklistedActors:x.blacklistedActors,actorToCommentInfoMap:x.actorToCommentIDMap,commentInfoMap:x.commentInfoMap,inAggregatedView:x.inAggregatedView,inModerationQueue:x.inModerationQueue,inContextualDialog:x.inContextualDialog,isTopLevelCommentPollingEnabled:false,loggedIn:x.loggedIn,newestCommentTimestamp:x.newestCommentTimestamp,realTimePollingParams:{},userOwnsPages:x.userOwnsPages,recentlyBlacklistedActors:x.blacklistedActors});g.subscribe(j.getArbiterType('comments_plugin_new_post'),function(y,z){if(z.obj.target===this.realTimePollingParams.target){if(u(z.obj.comment_element_id))return;var aa=t({},this.realTimePollingParams);aa.post_fbid=z.obj.post_fbid;var ba=z.obj.parent_comment_id;if(ba){var ca=u(ba);if(!ca)return;var da=l.scry(ca,'.fbFeedbackPager.uiMorePager');if(da.length>0)return;aa.parent_comment_id=ba;aa.is_reply_thread=true;}else{if(!this.isTopLevelCommentPollingEnabled)return;aa.is_reply_thread=false;}this.pollForComments(aa);}}.bind(this));this.controlledRegion=s(this.controllerID);this.attachClickHandlers();if(this.inModerationQueue)this.registerModeratorQueueHandlers(true);if(this.inContextualDialog)this.attachContextualDialogHandlers();if(!this.inAggregatedView)q.init({autoResize:true,channelUrl:x.channel,hideOverflow:true,resizeWidth:false});};t(w,{allControllers:{},mainController:null,contextualControllers:{},initController:function(x){var y=new w(x),z=x.controllerID;w.allControllers[z]=y;if(y.inContextualDialog){w.contextualControllers[z]=y;}else w.mainController=y;},syncController:function(x,y){var z=w.allControllers[x];z.attachClickHandlers();if(!z.isControllingModerationQueue())return;z.deselectComments(y);z.registerModeratorQueueHandlers(false);z.synchronizeModeratorQueueUI();},resetController:function(x){var y=w.allControllers[x];y.resetController();},appendComments:function(x,y,z){var aa=w.allControllers[x];aa.appendComments(y,z);},prependComments:function(x,y,z){var aa=w.allControllers[x];aa.prependComments(y,z);},updateController:function(x,y,z,aa,ba,ca,da){var ea=w.allControllers[x];ea.updateController(y,z,aa,ba,ca,da);if(!w.mainController.loggedIn)b('MultiLoginPopup').reattachLoginInterceptors();if(!ea.isControllingModerationQueue())return;ea.registerModeratorQueueHandlers(false);ea.synchronizeModeratorQueueUI();},updatePollingParamsCommentas:function(x,y){var z=w.allControllers[x];z.updatePollingParamsCommentas(y);},registerMoreCommentsLinkHandler:function(x,y){var z=w.allControllers[x];z.registerMoreCommentsLinkHandler(y);},setRealTimePollingParams:function(x,y){var z=w.allControllers[x];z.setRealTimePollingParams(y);},enableTopLevelCommentPolling:function(x){var y=w.allControllers[x];y.enableTopLevelCommentPolling();},disableTopLevelCommentPolling:function(x){var y=w.allControllers[x];y.disableTopLevelCommentPolling();},replaceContentMaybe:function(x,y){var z=l.scry(document.documentElement,x)[0];if(z)l.replace(z,y);},notifyCommentCreated:function(x){if(!w.mainController.channel)return;q.send({type:'commentCreated',href:x.href,parentCommentID:x.parentCommentID,commentID:x.commentID});},notifyCommentRemoved:function(x){if(!w.mainController.channel)return;q.send({type:'commentRemoved',href:x.href,commentID:x.commentID});},markAsShowingAllReplies:function(x){var y=x+' a.fbUpDownVoteOption',z=l.scry(document.documentElement,y),aa=x+' li.fbUpDownVoteOption a.itemAnchor',ba=l.scry(document.documentElement,aa),ca=z.concat(ba);for(var da=0;da<ca.length;da++){var ea=ca[da],fa=new r(ea.getAttribute('ajaxify'));fa.addQueryData({show_all_replies:1});ea.setAttribute('ajaxify',fa.toString());}},setLoggedIn:function(x){w.mainController.loggedIn=x;}});t(w.prototype,{isControllingModerationQueue:function(){var x=this==w.mainController&&this.inModerationQueue;return x;},resetController:function(){this.commentIDs=[];this.domIDs=[];},updateController:function(x,y,z,aa,ba,ca){x.forEach(function(ea){this.commentIDs.push(ea);},this);y.forEach(function(ea){this.domIDs.push(ea);},this);t(this.blacklistedActors,aa);for(var da in ba){if(!this.actorToCommentInfoMap[da])this.actorToCommentInfoMap[da]=[];ba[da].forEach(function(ea){this.actorToCommentInfoMap[da].push(ea);},this);}this.newestCommentTimestamp=Math.max(this.newestCommentTimestamp,z);t(this.commentInfoMap,ca);this.attachClickHandlers();},updatePollingParamsCommentas:function(x){this.realTimePollingParams.commentas=x;},attachClickHandlers:function(){for(var x=0;x<this.domIDs.length;x++){var y='li[id="'+this.domIDs[x]+'"]',z=l.scry(this.controlledRegion,y);if(z.length===0)continue;var aa=z[0],ba=l.scry(aa,'a.uiCloseButton');m.listen(aa,'mouseleave',this.closeStickyMenuFlyouts.bind(this,ba));var ca=l.scry(aa,'.fbModerateDropdownContainer');if(ca.length>0){var da=ca[0],ea=l.find(da,'.fbModerateDropdownLink');m.listen(ea,'mouseover',function(na,event){k.addClass(na,'fbUnderlineText');}.curry(ea));m.listen(ea,'mouseout',function(na,event){k.removeClass(na,'fbUnderlineText');}.curry(ea));var fa=l.find(da,'.fbModerationDropdownList');m.listen(ea,'click',this.exposeDropDownMenu.bind(this,ea,fa));m.listen(fa.parentNode,'mouseleave',this.concealDropDownMenu.bind(this,ea,fa));this.attachDropDownHandlers(aa,this.commentIDs[x],fa);}var ga=this.commentInfoMap[this.commentIDs[x]].actor,ha=!!this.recentlyBlacklistedActors[ga];if(ha){var ia=l.scry(aa,'.fbUndoBlacklistLink');if(ia.length>0){var ja=ia[0];m.listen(ja,'click',this.toggleBlackListAndSync.bind(this,this.commentIDs[x]));}}}var ka=l.scry(this.controlledRegion,'.fbReplyButton'),la=l.scry(this.controlledRegion,'.fbReplyAfterLoginButton');for(var ma=0;ma<ka.length;ma++)if(this.loggedIn){k.show(ka[ma]);k.hide(la[ma]);}else{k.hide(ka[ma]);k.show(la[ma]);}},closeStickyMenuFlyouts:function(x,event){p.hide();for(var y=0;y<x.length;y++)x[y].blur();},attachDropDownHandlers:function(x,y,z){var aa=l.scry(z,'.fbBanUser');if(aa.length>0){var ba=aa[0],ca=l.find(ba,'^.fbFeedbackPost');if(v(ca.id,y))m.listen(ba,'click',this.toggleBlackListAndSync.bind(this,y));}},exposeDropDownMenu:function(x,y,event){if(k.shown(y))return this.concealDropDownMenu(x,y,event);m.stop(event);k.show(y);y.focus();x.blur();return false;},concealDropDownMenu:function(x,y,event){m.stop(event);k.removeClass(x,'fbUnderlineText');k.hide(y);x.blur();return false;},registerMoreCommentsLinkHandler:function(x){var y=x.pager_id;if(!u(y))return;var z=s(y);m.listen(z,'click',this.fetchMoreComments.bind(this,x,z));},deselectComments:function(x){for(var y=0;y<x.length;y++)delete this.selectedCommentsMap[x[y]];},registerModeratorQueueHandlers:function(x){if(x)this.selectedCommentsMap={};this.selectableComments=this.findSelectableComments();this.selectableCheckboxes=[];this.selectAllCheckBoxes=l.scry(this.controlledRegion,'.fbSelectAllCheckbox');this.approveButtons=l.scry(this.controlledRegion,'.fbApproveButton');this.removeButtons=l.scry(this.controlledRegion,'.fbRemoveButton');for(var y=0;y<this.selectableComments.length;y++){var z=this.selectableComments[y].id,aa=!!this.selectedCommentsMap[z];this.setCommentSelection(this.selectableComments[y],aa);var ba=l.find(this.selectableComments[y],'.fbCommentCheckbox');m.listen(ba,'click',this.toggleCommentSelection.bind(this));m.listen(this.selectableComments[y],'click',this.toggleCommentSelection.bind(this));ba.checked=aa;this.selectableCheckboxes.push(ba);}for(var ca=0;ca<this.selectAllCheckBoxes.length;ca++){this.selectAllCheckBoxes[ca].checked=false;this.selectAllCheckBoxes[ca].disabled=this.selectableComments.length===0;m.listen(this.selectAllCheckBoxes[ca],'click',this.toggleSelectAllCheckbox.bind(this,this.selectAllCheckBoxes[ca]));}for(var da=0;da<this.approveButtons.length;da++)m.listen(this.approveButtons[da],'click',this.setBulkPrivacy.bind(this,false));for(var ea=0;ea<this.removeButtons.length;ea++)m.listen(this.removeButtons[ea],'click',this.setBulkPrivacy.bind(this,true));},findSelectableComments:function(){var x=l.scry(this.controlledRegion,'.fbTopLevelComment'),y=[];for(var z=0;z<x.length;z++)if((l.scry(x[z],'.fbCommentCheckbox').length===1)&&(l.scry(x[z],'.fbCommentOverlay').length===0))y.push(x[z]);return y;},toggleCommentSelection:function(event){var x={a:true},y=event.getTarget(),z=y.tagName.toLowerCase(),aa=y.parentNode.tagName.toLowerCase();if(x[z]||x[aa])return;var ba=k.hasClass(y,'fbFeedbackPost')?y:l.find(y,'^.fbFeedbackPost'),ca=this.commentIsSelected(ba),da=!ca;this.setCommentSelection(ba,da);this.synchronizeModeratorQueueUI();if(k.hasClass(y,'fbCommentCheckbox'))m.stop(event);},commentIsSelected:function(x){return k.hasClass(x,'fbCommentSelected');},setCommentSelection:function(x,y){if(y){this.selectComment(x);}else this.deselectComment(x);},selectComment:function(x){k.addClass(x,'fbCommentSelected');this.selectedCommentsMap[x.id]=true;l.find(x,'.fbCommentCheckbox').checked=true;},deselectComment:function(x){k.removeClass(x,'fbCommentSelected');delete this.selectedCommentsMap[x.id];l.find(x,'.fbCommentCheckbox').checked=false;},toggleSelectAllCheckbox:function(x,event){m.stop(event);var y=x.checked;for(var z=0;z<this.selectableComments.length;z++){this.setCommentSelection(this.selectableComments[z],x.checked);this.selectableCheckboxes[z].checked=y;}this.synchronizeBulkModerationCheckboxes(y);this.synchronizeBulkModerationButtons(y);},synchronizeModeratorQueueUI:function(){var x=0;for(var y=0;y<this.selectableCheckboxes.length;y++)if(this.selectableCheckboxes[y].checked)x++;var z=this.selectableCheckboxes.length>0&&x==this.selectableCheckboxes.length;this.synchronizeBulkModerationCheckboxes(z);this.synchronizeBulkModerationButtons(x>0);},synchronizeBulkModerationCheckboxes:function(x){for(var y=0;y<this.selectAllCheckBoxes.length;y++)this.selectAllCheckBoxes[y].checked=x;},synchronizeBulkModerationButtons:function(x){for(var y=0;y<this.approveButtons.length;y++)i.setEnabled(this.approveButtons[y],x);for(var z=0;z<this.removeButtons.length;z++)i.setEnabled(this.removeButtons[z],x);},setBulkPrivacy:function(x,event){m.stop(event);this.synchronizeBulkModerationButtons(false);var y=[];for(var z in this.selectedCommentsMap)y.push(z);var aa={is_private:x,in_moderation_queue:true,comment_ids:y,uniqids:y,controller_id:this.controllerID,locale:this.locale,owns_pages:this.userOwnsPages,in_aggregated_view:this.inAggregatedView,in_contextual_dialog:this.inContextualDialog};new h().setURI('/ajax/connect/comments/set_bulk_private.php').setData(aa).send();return false;},toggleBlackListAndSync:function(x,event){m.stop(event);var y=this.commentInfoMap[x].actor,z={blacklist:!this.blacklistedActors[y],in_moderation_queue:this.inModerationQueue,comment_id:x,other_comment_ids:this.getOtherCommentsByActor(y,x),uniqid:x,controller_id:this.controllerID,locale:this.locale,owns_pages:this.userOwnsPages,in_aggregated_view:this.inAggregatedView,in_contextual_dialog:this.inContextualDialog};new h().setURI('/ajax/connect/comments/set_blacklist.php').setData(z).setHandler(function(aa){this.blacklistedActors[y]=!this.blacklistedActors[y];if(this.blacklistedActors[y]){this.recentlyBlacklistedActors[y]=true;}else delete this.recentlyBlacklistedActors[y];}.bind(this)).send();return false;},getOtherCommentsByActor:function(x,y){return this.actorToCommentInfoMap[x].filter(function(z){return z!=y;});},fetchMoreComments:function(x,y,event){m.kill(event);k.addClass(y,'async_saving');if(this.fetchMoreCommentsIsPending[x.pager_id]===true)return;this.fetchMoreCommentsIsPending[x.pager_id]=true;var z={is_reply_thread:false,in_moderation_queue:false,view_as_moderator:false};t(z,x);z.offset=this.getVisibleCommentCount(z);if(!z.aggregate_view)delete z.aggregate_view;if(!z.comment_id)delete z.comment_id;if(!z.is_reply_thread)z.comment_ids=this.commentIDs;if(!z.commentas){var aa=w.allControllers[z.controller_id];z.commentas=aa.realTimePollingParams.commentas;}new h().setURI('/ajax/connect/feedback.php').setReadOnly(true).setData(z).setHandler(function(ba){this.fetchMoreCommentsIsPending[x.pager_id]=false;}.bind(this)).send();},getVisibleCommentCount:function(x){var y=this.getCommentsSelector(x),z=this.getCollapsedCommentsSelector(x),aa=l.scry(s(x.controller_id),y);aa=aa.concat(l.scry(s(x.controller_id),z));var ba=0;for(var ca=0;ca<aa.length;ca++)if(!k.hasClass(aa[ca],'fbCommentIgnored'))ba++;return ba;},getCommentsSelector:function(x){var y=x.is_reply_thread?'li.fbCommentReply':'li.fbTopLevelComment';if(x.controller_id!=x.uniqid)y='div[id="'+x.uniqid+'"] '+y;return y;},getCollapsedCommentsSelector:function(x){var y=x.is_reply_thread?'div.fbCommentReply':'div.fbTopLevelComment';if(x.controller_id!=x.uniqid)y='div[id="'+x.uniqid+'"] '+y;return y;},getRecentlyBlacklistedActors:function(){var x=[];for(var y in this.recentlyBlacklistedActors)x.push(y);return x;},attachContextualDialogHandlers:function(){this.documentClickListener=m.listen(document.documentElement,'click',this.closeContextualDialog.bind(this));},closeContextualDialog:function(event){var x=event.getTarget(),y=o.byClass(x,'fbCommentContext');if(!y)this.destroyContextualDialog();},destroyContextualDialog:function(){this.documentClickListener.remove();delete this.documentClickListener;var x=this.controllerID;n.closeContextualDialog(x);},setRealTimePollingParams:function(x){this.realTimePollingParams=x;},enableTopLevelCommentPolling:function(){this.isTopLevelCommentPollingEnabled=true;},disableTopLevelCommentPolling:function(){this.isTopLevelCommentPollingEnabled=false;},appendComments:function(x,y){var z=u(x);if(!z)return;var aa=l.scry(z,'.fbFeedbackReplies')[0];if(!aa)return;l.appendContent(aa,y);},prependComments:function(x,y){var z=l.scry(document.documentElement,x)[0];if(!z)return;var aa=y.getNodes(),ba=[];for(var ca=aa.length;ca-->0;){var da={id:l.getID(aa[ca]),element:aa[ca]};ba.push(da);var ea=u(da.id);if(ea){k.hide(da.element);this.duplicateComments.push(da.element);for(var fa=0;fa<ba.length;++fa)l.insertAfter(ea,ba[fa].element);ba=[];}}for(ca=0;ca<ba.length;++ca)l.prependContent(z,ba[ca].element);setTimeout(this.removeDuplicateComments.bind(this),0);},removeDuplicateComments:function(){for(var x=0;x<this.duplicateComments.length;++x)l.remove(this.duplicateComments[x]);this.duplicateComments=[];},pollForComments:function(x){var y={locale:this.locale};t(y,x);if(!y.is_reply_thread)y.comment_ids=this.commentIDs;y.newest_comment_timestamp=this.newestCommentTimestamp;var z=this.handlePollResponse.bind(this),aa=this.handlePollError.bind(this),ba=this.handlePollFinally.bind(this);new h().setURI('/plugins/comments/poll').setReadOnly(true).setData(y).setMethod('GET').setHandler(z).setErrorHandler(aa).setFinallyHandler(ba).send();},handlePollResponse:function(x){},handlePollError:function(x){},handlePollFinally:function(x){}});e.exports=window.CommentAdminPanelController||w;});
__d("legacy:developer-comments-js",["CommentAdminPanelController"],function(a,b,c,d){a.CommentAdminPanelController=b('CommentAdminPanelController');},3);
__d("ComposerPublishTrackingStory",["Event","ge","reportData","DOMQuery"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ge'),i=b('reportData'),j=b('DOMQuery');f.init=function(k){g.listen(k,'submit',function(){var l=h('home_stream');if(!l)return;var m=j.scry(l,'.uiStreamStory')[0];if(m&&m.getAttribute('data-ft')){var n=JSON.parse(m.getAttribute('data-ft'));if(!(("mf_story_key" in n)&&("qid" in n)))return;var o={mf_story_key:n.mf_story_key,qid:n.qid};i("compose",{ft:o});}});};});
__d("ComposerXAttachmentUtils",["CSS","DOMQuery","Focus","Input","PageTransitions","Run","StickyPlaceholderInput","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOMQuery'),i=b('Focus'),j=b('Input'),k=b('PageTransitions'),l=b('Run'),m=b('StickyPlaceholderInput'),n=b('tx'),o={initMentions:function(p,q){p.instance.setPlaceholder(q);var r=h.find(p.element,'textarea.input');i.set(r);},setStickyPlaceholderForMentions:function(p,q){if(h.contains(p.element,document.activeElement)&&g.hasClass(document.activeElement,'DOMControl_placeholder'))document.activeElement.blur();p.instance.setPlaceholder(q);},setStickyPlaceholderForTypeahead:function(p,q){var r=h.find(p,'.textInput');m.setPlaceholderText(r,q);},registerInputForLeaveWarning:function(p){l.onBeforeUnload(function(){var q=k.getNextURI();if(q.getQueryData().hasOwnProperty('theater'))return;if(a.Dialog&&a.Dialog.getCurrent())return;if(p.offsetParent!==null&&!j.isEmpty(p))return "You haven't finished your post yet. Do you want to leave without finishing?";});}};e.exports=o;});
__d("PrivacyConst",[],function(a,b,c,d,e,f){var g={FRIENDS_PLUS_GAMER_FRIENDS:128,FRIENDS_MINUS_ACQUAINTANCES:127,FACEBOOK_EMPLOYEES:112,CUSTOM:111,EVERYONE:80,NETWORKS_FRIENDS_OF_FRIENDS:60,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SELF:10,NOBODY:0},h={EVERYONE:80,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SOME_FRIENDS:30,SELF:10,NO_FRIENDS:0},i={BaseValue:g,FriendsValue:h};e.exports=i;});
__d("ComposerXBootloadStatusAttachment",["Event","function-extensions","Arbiter","AsyncRequest","Bootloader","Class","ComposerXAttachment","ComposerXController","ComposerXDragDrop","CSS","DOM","DOMQuery","Focus","Parent","PlaceholderListener","PrivacyConst","URI","Selector","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Arbiter'),i=b('AsyncRequest'),j=b('Bootloader'),k=b('Class'),l=b('ComposerXAttachment'),m=b('ComposerXController'),n=b('ComposerXDragDrop'),o=b('CSS'),p=b('DOM'),q=b('DOMQuery'),r=b('Focus'),s=b('Parent'),t=b('PlaceholderListener'),u=b('PrivacyConst'),v=b('URI'),w=b('Selector'),x=b('copyProperties'),y=b('csx'),z=b('cx'),aa={};function ba(ca,da){this.parent.construct(this);this._root=ca;this._config=da;}k.extend(ba,l);x(ba.prototype,{_attachmentIsActive:false,_bootloading:false,_fullVersion:false,_focusListener:null,_privacyWidgetTags:null,_scraper:null,_dragdrop:null,attachmentClassName:"_4j",getRoot:function(){return this._root;},initWithComponents:function(ca){aa[this._composerID]=this;this._attachmentIsActive=true;var da=q.find(this.getComponent('maininput').element,'textarea.input');if(this._fullVersion){this._fullInitWithComponents();}else if(!this._bootloading)if(q.contains(this._root,document.activeElement)){this._onInitialFocus();}else this._focusListener=g.listen(da,'focus',this._onInitialFocus.bind(this));this._dragEnterHandler=h.subscribe('dragenter',function(ea,fa){if(fa.element==this._root){var ga=fa.event.dataTransfer.items,ha;if(ga)ha=n.filterImages(ga);if(ha&&ha.length>0){r.set(da);}else{var ia=s.byClass(this._root,'focus_target');t.expandInput(ia);if(!this._bootloading&&!this._fullVersion)this._onInitialFocus();}}}.bind(this));this.getComponent('maininput').instance.setPlaceholder(this._config.mentionsPlaceholder);if(!ca)r.set(da);if(this._config.plus_version){this._dragdrop=new n(this._root,this._composerID,this._config.targetID);this._dragdrop.enableURLDropping();}},_fullInitWithComponents:function(){j.loadModules(['ComposerXPrivacyWidgetTags','URLScraper','URI'],function(ca,da,ea){this._tagger.init(this);this._privacyWidgetTags=new ca(this);var fa=q.find(this.getComponent('maininput').element,'textarea.input');if(!this._scraper){this._scraper=new da(fa);this._scraper.subscribe('match',function(ga,ha){var ia=this._getScraperEndpoint();ia.addQueryData({scrape_url:encodeURIComponent(ha.url)});m.getAttachment(this._root,ia.toString());}.bind(this));}this._scraper.enable();this._scraper.check();}.bind(this));this._initPrivacyReminder();},_initPrivacyReminder:function(){if(!this._reminderDialog||this._reminderShown)return;var ca=this.getComponent('mainprivacywidget'),da=w.getSelectedOptions(ca.element),ea=w.getOptionValue(da[0]);if(ea!==String(u.BaseValue.SELF))return;this._reminderDialog.setContext(this.getComponent('mainprivacywidget').element).show();this._reminderShown=true;var fa=function(){new i('/ajax/privacy/reminders/dismiss').setData({type:'only_me'}).send();this._reminderDialog.hide();}.bind(this);this._reminderEvents=[g.listen(this._reminderDialog.getContent(),'click',fa),g.listen(this._reminderDialog.getContext(),'click',fa)];},cleanup:function(){this._attachmentIsActive=false;if(this._focusListener){this._focusListener.remove();this._focusListener=null;}if(this._reminderDialog&&this._reminderShown){this._reminderDialog.hide();this._reminderEvents.forEach(function(ca){ca.remove();});}if(this._dragdrop){this._dragdrop.deactivate();this._dragdrop=null;}if(this._fullVersion){this._tagger.cleanup();this._privacyWidgetTags.destroy();this._privacyWidgetTags=null;this._scraper.disable();}if(this._dragEnterHandler){this._dragEnterHandler.unsubscribe();this._dragEnterHandler=null;}},reset:function(){var ca=s.byClass(this._root,"child_was_focused");if(ca)o.removeClass(ca,"child_was_focused");if(this._tagger)this._tagger.reset();this.getComponent('maininput').instance.setPlaceholder(this._config.mentionsPlaceholder);},canSwitchAway:function(){return !s.byClass(this._root,'async_saving');},setBootloadedContent:function(ca,da,ea,fa){this._reminderDialog=fa;var ga=q.find(this._root,"._3-6"),ha=q.find(this._root,"._3-7");p.setContent(ga,ca.tagger_content);p.setContent(ha,ca.tagger_icons);m.addPlaceholders(this._root,this,ea);this._tagger=da;this._fullVersion=true;if(this._attachmentIsActive){if(this._focusListener){this._focusListener.remove();this._focusListener=null;}this._fullInitWithComponents();}},_getScraperEndpoint:function(){return v('/ajax/composerx/attachment/link/scraper/');},_onInitialFocus:function(){m.getEndpoint(this._root,'/ajax/composerx/attachment/status/bootload/',true);this._bootloading=true;},allowOGTagPreview:function(){return true;}});ba.setBootloadedContent=function(ca,da,ea,fa,ga){var ha=aa[ca];if(ha)ha.setBootloadedContent(da,ea,fa,ga);};e.exports=ba;});
__d("ComposerXMentionsInputReset",["DOMQuery","Input"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('Input');function i(j){var k=g.scry(j.element,'textarea.input')[0];j.instance.reset();h.reset(k);}e.exports=i;});
__d("ComposerXPrivacyWidgetReset",["Arbiter"],function(a,b,c,d,e,f){var g=b('Arbiter');function h(i){g.inform('Composer/changedtags',{withTags:[],mention:{},eventTag:false});}e.exports=h;});
__d("ComposerXTaggerIconReset",["CSS","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx');function i(j){g.removeClass(j.element,"_1dsa");g.removeClass(j.element,"_1dsb");g.removeClass(j.element,"_509o");}e.exports=i;});
__d("ConnectLogin",["PopupWindow","URI","WindowComm","XD"],function(a,b,c,d,e,f){var g=b('PopupWindow'),h=b('URI'),i=b('WindowComm'),j=b('XD').XD,k={init:function(l){this.appID=l.appID;this.addToProfile=l.addToProfile;this.channelUrl=l.channelUrl;j.init(l);},login:function(l,m,n){this._openPopup(l,m,n);},logout:function(){j.send({type:'logout'});},_openPopup:function(l,m,n){n=n||{};var o=i.makeHandler(function(s){k._closePopup();if(k.appID)k._refreshLoginStatus();l&&l();}),p=i.makeHandler(function(s){k._closePopup();}),q=new h('/login.php');q.setQueryData({api_key:this.appID,next:o,channel_url:p,cancel_url:p,req_perms:m,v:'1.0',fbconnect:1,add_to_profile:this.addToProfile,display:'popup'});q.addQueryData(n);var r=this._getSize(n);this._popup=g.open(q.toString(),r.height,r.width);},_closePopup:function(){if(this._popup){this._popup.close();this._popup=null;}},_refreshLoginStatus:function(){if(this.channelUrl){j.send({type:'refreshLoginStatus'});}else window.location.reload();},_getSize:function(l){if(l.social_plugin=='registration'){return {width:640,height:370};}else return {width:610,height:280};}};e.exports=k;});
__d("legacy:connect-login",["ConnectLogin"],function(a,b,c,d){a.ConnectLogin=b('ConnectLogin');},3);
__d("legacy:feedback",["Feedback"],function(a,b,c,d){a.Feedback=b('Feedback');},3);
__d("CustomPrivacyOption",["Event","Arbiter","AsyncDialog","AsyncRequest","DOM","Form","Parent","PrivacyConst","Selector","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('DOM'),l=b('Form'),m=b('Parent'),n=b('PrivacyConst'),o=b('Selector'),p=b('copyProperties');function q(r,s,t,u,v,w,x,y){if(!r)return;(function(){this.initCustomState(r,s,t);g.listen(r,'click',function(event){this.openCustomDialog(event,s,u,w,x,y);}.bind(this));this._initSelector(r,v);}).bind(this).defer();}p(q,{_instances:{},update:function(r,s,t,u){var v=q._instances[r];v._update(s,t)._updateOption(t,u);h.inform('Form/change',{node:v._container});},getData:function(r){return q._instances[r]._privacyData;},setPrivacyData:function(r,s,t){q._instances[r]._update(s,t);}});p(q.prototype,{_initSelector:function(r,s){this._selector=m.byClass(r,'uiSelector');o.listen(this._selector,'select',function(t){if(t.option._id!=this._id)this.clearCustomState();}.bind(this));if(s)o.setButtonTooltip(this._selector,s);},_updateOption:function(r,s){var t=o.getOption(this._selector,r)||o.getOption(this._selector,n.BaseValue.CUSTOM+'');h.inform('CustomPrivacyOption/update',{selector:this._selector,option:t,tooltip:s});return this;},_update:function(r,s){var t=s==n.BaseValue.CUSTOM||!o.getOption(this._selector,s),u=this._selector.getAttribute('data-name');this.updateCustomState(r,t,u);return this;},initCustomState:function(r,s,t){q._instances[s]=this;this._container=k.find(r,'.customPrivacyInputs');this._id=t;this._privacyData={};var u=l.serialize(this._container);if(u.audience)this._privacyData=u.audience[t];return r;},openCustomDialog:function(event,r,s,t,u,v){var w=new j('/ajax/privacy/custom_dialog/').setData({option_id:r,id:this._id,privacy_data:this._privacyData,explain_tags:s,autosave:t,limit_to_friends:u,source:v});w.setRelativeTo(event.getTarget());i.send(w);},updateCustomState:function(r,s,t){this.clearCustomState();this._privacyData=p({},r);if(s)if(t){t=t.slice(0,-'[value]'.length);var u={};u[t]=r;l.createHiddenInputs(u,this._container,null,true);}},clearCustomState:function(){this._privacyData={};k.empty(this._container);}});e.exports=q;});
__d("DynamicIconSelector",["Button","CSS","DOM","Selector"],function(a,b,c,d,e,f){var g=b('Button'),h=b('CSS'),i=b('DOM'),j=b('Selector'),k={swapIcon:function(l){var m=j.getSelectedOptions(l)[0],n=m&&i.scry(m,'.itemIcon')[0],o=j.getSelectorButton(l);if(n){g.setIcon(o,n.cloneNode(true));}else{var p=i.scry(o,'.img')[0];p&&i.remove(p);}h.conditionClass(o,'uiSelectorChevronOnly',!n);}};j.subscribe('change',function(l,m){var n=m.selector;if(h.hasClass(n,'dynamicIconSelector'))k.swapIcon(n);});e.exports=k;});
__d("AudienceSelector",["Arbiter","CSS","CustomPrivacyOption","DOM","DynamicIconSelector","PrivacyConst","Selector"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('CustomPrivacyOption'),j=b('DOM'),k=b('DynamicIconSelector'),l=b('PrivacyConst'),m=b('Selector'),n={};m.subscribe('select',function(q,r){if(!h.hasClass(r.selector,'audienceSelector'))return;var s=m.getOptionValue(r.option);g.inform('AudienceSelector/changed',r);if(s==l.BaseValue.CUSTOM&&!h.hasClass(r.option,'noDialog')){m.toggle(r.selector);return false;}if(h.hasClass(r.selector,'dataTooltip')){var t=j.find(r.option,'.itemAnchor').getAttribute('data-tooltip');m.setButtonTooltip(r.selector,t||null);}if(!h.hasClass(r.option,'specialOption'))return;var u=j.find(r.option,'a').getAttribute('data-type');if(h.hasClass(r.option,'moreOption')){h.addClass(r.selector,u);h.addClass(r.selector,'showSecondaryOptions');return false;}else if(h.hasClass(r.option,'returnOption')){h.removeClass(r.selector,'showSecondaryOptions');h.removeClass(r.selector,'friendList');return false;}});var o={},p={hasTags:function(q){return o.hasOwnProperty(q);},keepSynchronized:function(q,r){n[q]||(n[q]={});n[q][r.id]=r;},setHasTags:function(q){if(!q)return;o[q]=true;}};g.subscribe('CustomPrivacyOption/update',function(q,r){if(!h.hasClass(r.selector,'audienceSelector'))return;m.setSelected(r.selector,m.getOptionValue(r.option));k.swapIcon(r.selector);m.setButtonTooltip(r.selector,r.tooltip);g.inform('AudienceSelector/update',r);});g.subscribe(['AudienceSelector/changed','AudienceSelector/update'],function(event,q){var r=m.getOptionValue(q.option),s={};if(r==l.BaseValue.CUSTOM){if(event=='AudienceSelector/changed')return;s=i.getData(q.option.id);}for(var t in n){var u=n[t];if(u[q.selector.id])for(var v in u){var w=u[v];if(!w||q.selector===w)continue;if(m.getValue(w)!==r){m.setSelected(w,r);k.swapIcon(w);}if(r==l.BaseValue.CUSTOM){var x=m.getOption(w,l.BaseValue.CUSTOM+'');if(x){i.setPrivacyData(x.id,s,r);m.setButtonTooltip(w,q.tooltip);}}}}});e.exports=p;});
__d("ComposerAudienceSelector",["DynamicIconSelector","CustomPrivacyOption","PrivacyConst","Selector"],function(a,b,c,d,e,f){b('DynamicIconSelector');var g=b('CustomPrivacyOption'),h=b('PrivacyConst'),i=b('Selector'),j={},k={},l={syncSelector:function(m){j[m]&&i.setSelected(m,j[m]);if(j[m]==h.BaseValue.CUSTOM&&k[m]){var n=i.getOption(m,h.BaseValue.CUSTOM+''),o=k[m];(function(){g.update(n.id,o.data,o.audience,o.tooltip);}).defer();}}};e.exports=l;});
__d("legacy:AudienceSelector",["AudienceSelector"],function(a,b,c,d){b('AudienceSelector');},3);
__d("legacy:ComposerAudienceSelector",["ComposerAudienceSelector"],function(a,b,c,d){a.ComposerAudienceSelector=b('ComposerAudienceSelector');},3);
__d("FriendListPrivacyOptions",["Arbiter","AsyncDialog","AsyncRequest","Dialog","DOMQuery","PageTransitions","Parent","Selector","$","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('Dialog'),k=b('DOMQuery'),l=b('PageTransitions'),m=b('Parent'),n=b('Selector'),o=b('$'),p=b('ge'),q=false,r=false,s=null,t={},u=function(w){if(!Object.keys(t).length)l.registerHandler(function(){t={};q=false;r=false;});var x=w.getAttribute('data-name');t[x]=w;n.listen(w,'select',function(y){var z=y.option,aa=k.find(z,'a.itemAnchor'),ba=aa.getAttribute('data-flid');if(!ba)return;var ca=aa.getAttribute('data-dynamic');if(ca&&q){v.showSmartListNux(z,ba);}else if(!ca&&r)v.showDumbListNux([ba]);});},v={listen:function(w,x,y){var z=p(w);if(!z)return;var aa=m.byClass(z,'audienceSelector');if(aa){u(aa);q=x;r=y;}},showSmartListNux:function(w,x){w=o(w);new i('/ajax/friends/lists/smart_list_publish_nux.php').setData({option_id:w.id,flid:x}).send();q=false;},setContextualDialog:function(w,x){x=o(x);var y=m.byClass(x,'audienceSelector');if(y){w.setContext(y);w.show();var z=g.subscribe('composer/publish',function(){w.hide();});w.subscribe('hide',function(){z.unsubscribe();});}},showDumbListNux:function(w){h.send(new i('/ajax/friends/lists/dumb_list_publish_nux.php').setData({flids:w}));r=false;},showBothListsNux:function(w,x){s=o(w);v.showDumbListNux(x);},setDialogX:function(w){if(!s)return;w.subscribe('hide',function(){v.showSmartListNux(s);s=null;});},setDialog:function(){if(!s)return;var w=j.getCurrent();if(w)w.setCloseHandler(function(){v.showSmartListNux(s);s=null;});}};e.exports=v;});
__d("OnlyMePrivacyOption",["Arbiter","copyProperties","CSS","DOM","Env","Parent","PrivacyConst","Selector","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('Env'),l=b('Parent'),m=b('PrivacyConst'),n=b('Selector'),o=b('tx');function p(q){this._selector=l.byClass(q,'composerAudienceSelector');this._plusLabel=j.scry(q,'.plusLabel')[0];if(!this._selector)return;this._elem=q;this._taggedIDs=[];this._tags=[];this._hasEvent=false;this._recalculateTooltipAndLabel();this._updateSelector();g.subscribe('Composer/changedtags',function(r,s){var t=this._hasEvent;this._hasEvent=!!s.eventTag;this._tags=s.withTags.map(function(v){return v.getText();});this._taggedIDs=s.withTags.map(function(v){return v.getValue();});for(var u in s.mention)if(s.mention[u].type=='user'&&s.mention[u].uid!=k.user){this._tags.push(s.mention[u].text);this._taggedIDs.push(s.mention[u].uid);}else if(s.mention[u].type=='event')this._hasEvent=true;if(this._hasEvent&&t!=this._hasEvent)this._eventTagChanged();if(this._recalculateTooltipAndLabel()&&n.isOptionSelected(this._elem)){this._updateSelector();g.inform('SelectedPrivacyOption/changed',this._getChangedData());}}.bind(this));n.listen(this._selector,'change',this._updateSelector.bind(this));}h(p.prototype,{_eventTagChanged:function(){},_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:m.FriendsValue.SELF};},_recalculateTooltipAndLabel:function(){var q=this._tooltip,r=this._label;if(this._taggedIDs.length){this._tooltip="Anyone tagged";this._label="Only Me"+' (+)';}else{this._tooltip="Only you";this._label="Only Me";}i.conditionShow(this._plusLabel,this._taggedIDs.length);return (q!=this._tooltip)||(r!=this._label);},_updateSelector:function(){if(n.isOptionSelected(this._elem)){n.setButtonLabel(this._selector,this._label);n.setButtonTooltip(this._selector,this._tooltip);return false;}return true;}});e.exports=p;});
__d("FriendsMinusAcquaintancesPrivacyOption",["Class","OnlyMePrivacyOption","PrivacyConst","CSS","tx","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('OnlyMePrivacyOption'),i=b('PrivacyConst'),j=i.FriendsValue,k=b('CSS'),l=b('tx'),m=b('copyProperties');function n(o,p){this._hasRestricted=p;this.parent.construct(this,o);}g.extend(n,h);m(n.prototype,{_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:j.FRIENDS_MINUS_ACQUAINTANCES};},_recalculateTooltipAndLabel:function(){var o=this._hasEvent,p=this._tags.length,q=this._tooltip,r=this._label,s=this._taggedIDs.length||this._hasEvent;if(o){if(p>1){this._tooltip=this._hasRestricted?"Your friends, friends of anyone tagged and event guests; Except: Acquaintances, Restricted":"Your friends, friends of anyone tagged and event guests; Except: Acquaintances";}else if(p==1){if(this._hasRestricted){this._tooltip=l._("Your friends, {user}'s friends and event guests; Except: Acquaintances, Restricted",{user:this._tags[0]});}else this._tooltip=l._("Your friends, {user}'s friends and event guests; Except: Acquaintances",{user:this._tags[0]});}else this._tooltip=this._hasRestricted?"Your friends and event guests; Except: Acquaintances, Restricted":"Your friends and event guests; Except: Acquaintances";}else this._tooltip=this._hasRestricted?"Friends except Acquaintances, Restricted":"Friends except Acquaintances";k.conditionShow(this._plusLabel,s);this._label=this._elem.getAttribute('data-label');if(s)this._label+=' (+)';return ((q!=this._tooltip)||(r!=this._label));}});e.exports=n;});
__d("FriendsPrivacyOption",["Arbiter","Class","CSS","OnlyMePrivacyOption","PrivacyConst","Selector","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('CSS'),j=b('OnlyMePrivacyOption'),k=b('PrivacyConst'),l=b('Selector'),m=b('tx');function n(o,p){this._hasRestricted=p;this.parent.construct(this,o);}h.extend(n,j);n.prototype._getChangedData=function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:k.FriendsValue.ALL_FRIENDS};};n.prototype._eventTagChanged=function(){var o=this._getChangedData();o.privacy=l.getValue(this._selector);g.inform('EventTagged/changed',o);};n.prototype._recalculateTooltipAndLabel=function(){var o=this._hasEvent,p=this._tags.length,q=this._tooltip,r=this._label;if(p>2){if(o){this._tooltip=this._hasRestricted?"Your friends, friends of anyone tagged and event guests; Except: Restricted":"Your friends, friends of anyone tagged and event guests";}else this._tooltip=this._hasRestricted?"Your friends and friends of anyone tagged; Except: Restricted":"Your friends and friends of anyone tagged";}else if(p==2){if(o){if(this._hasRestricted){this._tooltip="Your friends, friends of anyone tagged and event guests; Except: Restricted";}else this._tooltip="Your friends, friends of anyone tagged and event guests";}else if(this._hasRestricted){this._tooltip=m._("Your friends, {user}'s friends and {user2}'s friends; Except: Restricted ",{user:this._tags[0],user2:this._tags[1]});}else this._tooltip=m._("Your friends, {user}'s friends and {user2}'s friends",{user:this._tags[0],user2:this._tags[1]});}else if(p==1){if(o){if(this._hasRestricted){this._tooltip=m._("Your friends, {user}'s friends and event guests; Except: Restricted",{user:this._tags[0]});}else this._tooltip=m._("Your friends, {user}'s friends and event guests",{user:this._tags[0]});}else if(this._hasRestricted){this._tooltip=m._("Your friends and {user}'s friends; Except: Restricted",{user:this._tags[0]});}else this._tooltip=m._("Your friends and {user}'s friends",{user:this._tags[0]});}else if(o){this._tooltip=this._hasRestricted?"Your friends and event guests; Except: Restricted":"Your friends and event guests";}else this._tooltip=this._hasRestricted?"Your friends; Except: Restricted":"Your friends";i.conditionShow(this._plusLabel,this._tags.length);this._label=this._elem.getAttribute('data-label');if(this._tags.length||this._hasEvent)this._label+=' (+)';return (q!=this._tooltip)||(r!=this._label);};e.exports=n;});
__d("MetaComposerEdDialog",["Animation","Arbiter","ARIA","AsyncRequest","copyProperties","CSS","DOM","Ease","ge","Parent","Selector","Vector"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ARIA'),j=b('AsyncRequest'),k=b('copyProperties'),l=b('CSS'),m=b('DOM'),n=b('Ease'),o=b('ge'),p=b('Parent'),q=b('Selector'),r=b('Vector'),s=null;function t(u){this._dialog=u.dialog;this.config=u;this._init();}t.init=function(u){if(s){s.config.show_audience=u.show_audience;u.dialog.destroy();return;}s=new t(u);};k(t.prototype,{_init:function(){h.subscribe('ComposerXStatusAttachment/ready',function(){if(this.config.show_audience){this._sendEducationRequest({},'/ajax/composer/audience/education',this._handlerCustomDuration.bind(this,6000));this.config.show_audience=false;}}.bind(this));if(this.config.show_sticky)h.subscribe('composer/mutate',function(u,v){this._sendEducationRequest({sticky_num:this.config.n_sticky_shown},'/ajax/composer/audience/sticky_education');}.bind(this));if(this.config.show_event_tags)if(this.config.n_event_tag_shown===0){h.subscribe('EventTagged/changed',function(u,v){this._sendEducationRequest({id:"composerTourAudience",privacy:v.privacy,event_tag_num:this.config.n_event_tag_shown},'/ajax/events/tagging/user_education');}.bind(this));h.subscribe(['composer/publish','composer/reset'],function(){var u=o("event_tagging_tag_expansion_NUX");u&&l.hide(u);}.bind(this));}else h.subscribe('EventTagged/changed',function(u,v){this._sendEducationRequest({ids:v.tags,from:'AtTagger',hasEvent:v.hasEvent,type:v.privacy,tag_num:this.config.n_tag_shown,event_tag_num:this.config.n_event_tag_shown},'ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));if(this.config.show_tags)h.subscribe('SelectedPrivacyOption/changed',function(u,v){this._sendEducationRequest({ids:v.tags,from:'WithTagger',hasEvent:v.hasEvent,type:v.privacy,tag_num:this.config.n_tag_shown,event_tag_num:this.config.n_event_tag_shown},'/ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));q.subscribe('open',this._killAnim.bind(this));},_sendEducationRequest:function(u,v,w){if(!this._updateDialogContext())return;this._async&&this._async.abort();this._async=new j(v);this._async.setData(u).setHandler(w).send();},_updateDialogContext:function(){var u=m.scry(document.body,'div.composerAudienceWrapper'),v,w;for(var x=0;x<u.length;x++){v=u[x];w=r.getElementPosition(v);if(v&&w.x>0&&w.y>0){this._dialog.setContext(v);return true;}}return false;},_handler:function(u){this._handlerCustomDuration(1500,u);},_handlerCustomDuration:function(u,v){var w=v.payload;if(!w||!this._updateDialogContext())return;var x=this._dialog.getContent().firstChild;m.setContent(x,w);i.announce(m.getText(x));this._dialog.show();var y=p.byClass(x,'metaComposerUserEd');if(this._anim){this._anim.stop();this._anim=new g(y);}else this._anim=new g(y).from('opacity',0);this._anim.to('opacity',1).ease(n.sineOut).checkpoint().duration(u).checkpoint().to('opacity',0).ease(n.sineOut).checkpoint().ondone(this._killAnim.bind(this)).go();},_killAnim:function(u,v){if(this._anim){this._dialog.hide();this._anim.stop();this._anim=null;}}});e.exports=t;});
__d("MentionsTypeaheadAreaView",["Class","ContextualTypeaheadView","Parent","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('ContextualTypeaheadView'),i=b('Parent'),j=b('copyProperties');function k(l,m){this.parent.construct(this,l,m);}g.extend(k,h);j(k.prototype,{getContext:function(){return i.byClass(this.element,'uiMentionsInput');}});e.exports=k;});
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("TypeaheadAreaCore",["Class","InputSelection","TypeaheadCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Class'),h=b('InputSelection'),i=b('TypeaheadCore'),j=b('copyProperties'),k=b('emptyFunction');function l(m){this.parent.construct(this,m);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}g.extend(l,i);j(l.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:k,select:function(m){this.parent.select(m);var n=this.element.value,o=this.prefix+m.text+this.suffix;this.expandBounds(n,o);var p=n.substring(0,this.start),q=n.substring(this.end);this.element.value=p+o+q;h.set(this.element,p.length+o.length);},expandBounds:function(m,n){m=m.toLowerCase();n=n.toLowerCase();var o,p,q,r,s=/\s/;p=m.substring(this.start,this.end);q=n.indexOf(p);o=this.start;while(o>=0&&q>=0){r=m.charAt(o-1);if(!r||s.test(r))this.start=o;p=r+p;q=n.indexOf(p);o--;}p=m.substring(this.start,this.end);q=n.indexOf(p);o=this.end;while(o<=m.length&&q>=0){r=m.charAt(o);if(!r||s.test(r))this.end=o;p=p+r;q=n.indexOf(p);o++;}},getRawValue:function(){var m=h.get(this.element).start||0;return this.parent.getValue().substring(0,m);},getValue:function(){var m=this.matcher&&this.matcher.exec(this.getRawValue());if(!m)return '';var n=m[0],o=m.index+n.length;n=n.replace(/^\s/,'');var p=n.length;n=n.replace(/\s$/,'');var q=p-n.length;this.start=o-p;this.end=o+q;return m[1]||m[0];}});e.exports=l;});
__d("TypeaheadMetrics",["Event","AsyncRequest","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this.extraData={};i(this,l);}i(k.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php',init:function(l){this.init=j;this.core=l.getCore();this.view=l.getView();this.data=l.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.results=null;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(l){var m=l.selected;if(m.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',m.uid);this.recordStat('selected_type',m.type);this.recordStat('selected_position',l.index);this.recordStat('selected_with_mouse',l.clicked?1:0);this._sessionEnd();},bindSessionStart:function(l,event,m){if(m)for(var n=0;n<this._sessionStartEvents.length;++n){var o=this._sessionStartEvents[n];o.obj.unsubscribe(o.token);}this._sessionStartEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionStart();}.bind(this))});},bindSessionEnd:function(l,event,m){if(m)for(var n=0;n<this._sessionEndEvents.length;++n){var o=this._sessionEndEvents[n];o.obj.unsubscribe(o.token);}this._sessionEndEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(l,m){this.recordSelect(m);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(l,m){this.results=m;}.bind(this));this.data.subscribe('beforeQuery',function(l,m){if(!m.value)return;this.query=m.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(l,m){if(m.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else m.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(l,m){if(m.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var n={};m.response.payload.entries.forEach(function(o){if(!n[o.type]){n[o.type]=1;}else n[o.type]++;});this.recordStat('bootstrap_response_types',n);this.bootstrapped=true;}else{if('filtered_count' in m.response.payload)this.recordStat('filtered_count',m.response.payload.filtered_count);this.recordAvgStat('avg_query_latency',Date.now()-m.fetch_context.queryBegin);}}.bind(this));this.data.subscribe('dirty',function(l,m){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(l,m){this.stats[l]=m;},recordCountStat:function(l){var m=this.stats[l];this.stats[l]=m?m+1:1;},recordAvgStat:function(l,m){if(this.avgStats[l]){this.avgStats[l][0]+=m;++this.avgStats[l][1];}else this.avgStats[l]=[m,1];},submit:function(){if(Object.keys(this.stats).length){i(this.stats,this.extraData);if(this.results){var l=(this.results).map(function(o,p){return o.uid;});this.recordStat('candidate_results',JSON.stringify(l));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var m in this.avgStats){var n=this.avgStats[m];this.stats[m]=n[0]/n[1];}new h().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}});k.register=function(l,m,n){if(document.activeElement===l){m.init(n);}else var o=g.listen(l,'focus',function(){m.init(n);o.remove();});};e.exports=k;});
__d("TypeaheadHoistFriends",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;}g(h.prototype,{_subscription:null,enable:function(){var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[],n=[];for(var o=0;o<k.results.length;++o){var p=k.results[o];if(p.type=='header'){n=n.concat(m,l);n.push(p);m=[];l=[];}else if(p.type=='user'&&p.bootstrapped){m.push(p);}else l.push(p);}k.results=n.concat(m,l);});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=h;});
__d("legacy:HoistFriendsTypeaheadBehavior",["TypeaheadHoistFriends"],function(a,b,c,d){var e=b('TypeaheadHoistFriends');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hoistFriends=function(f){f.enableBehavior(e);};},3);